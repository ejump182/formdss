function object(e){var t=function(){};t.prototype=e;return new t}var QuickSelect;(function(e){QuickSelect=function(t,n){var r=this;t=e(t);t.attr("autocomplete","off");r.options=n;r.AllItems={};var i=false,s=-1,o=false,u,a,f,l=false,c,h;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){if(Number(RegExp.$1)<=7)l=true}c=e('<div class="'+n.resultsClass+'" style="display:block;position:absolute;z-index:9999;"></div>').hide();h=e("<iframe />");h.css({border:"none",position:"absolute"});if(n.width>0){c.css("width",n.width);h.css("width",n.width)}e("body").append(c);c.hide();if(l)e("body").append(h);r.getLabel=function(e){return e.label||(typeof e==="string"?e:e[0])||""};var p=function(e){return e.values||(e.value?[e.value]:typeof e==="string"?[e]:e)||[]};var d=function(i){var o=e("li",c);if(!o)return;if(typeof i==="number")s=s+i;else s=o.index(i);if(s<0)s=0;else if(s>=o.size())s=o.size()-1;o.removeClass(n.selectedClass);e(o[s]).addClass(n.selectedClass);if(n.autoFill&&r.last_keyCode!=8){t.val(a+e(o[s]).text().substring(a.length));var u=a.length,f=t.val().length,l=t.get(0);if(l.createTextRange){var h=l.createTextRange();h.collapse(true);h.moveStart("character",u);h.moveEnd("character",f);h.select()}else if(l.setSelectionRange){l.setSelectionRange(u,f)}else if(l.selectionStart){l.selectionStart=u;l.selectionEnd=f}l.focus()}};var v=function(){if(f){clearTimeout(f)}t.removeClass(n.loadingClass);if(c.is(":visible"))c.hide();if(h.is(":visible"))h.hide();s=-1};r.selectItem=function(i,s){if(!i){i=document.createElement("li");i.item=""}var o=r.getLabel(i.item),u=p(i.item);t.lastSelected=o;t.val(o);a=o;c.empty();e(n.additionalFields).each(function(t,n){e(n).val(u[t+1]);e(this).change()});if(!s)v();if(n.onItemSelect)setTimeout(function(){n.onItemSelect(i)},1);return true};var m=function(){var i=e("li."+n.selectedClass,c).get(0);if(i){return r.selectItem(i)}else{if(n.exactMatch){t.val("");e(n.additionalFields).each(function(t,n){e(n).val("");e(this).change()})}return false}};var g=function(i){c.empty();if(!o||i===null||i.length===0){return v()}var s=document.createElement("ul"),u=i.length,a=function(){d(this)},f=function(){},l=function(e){e.preventDefault();e.stopPropagation();r.selectItem(this)};c.append(s);if(n.maxVisibleItems>0&&n.maxVisibleItems<u)u=n.maxVisibleItems;for(var h=0;h<u;h++){var p=i[h],m=document.createElement("li");c.append(m);e(m).text(n.formatItem?n.formatItem(p,h,u):r.getLabel(p));m.item=p;if(p.className)m.className=p.className;s.appendChild(m);e(m).hover(a,f).click(l)}t.removeClass(n.loadingClass);return true};var y=function(e,t){n.finderFunction.apply(r,[e,function(i){g(n.matchMethod.apply(r,[e,i]));t()}])};var b=function(){var r=t.offset(),i=n.width>0?n.width:t.width(),s=e("li",c);c.css({width:parseInt(i,10)+"px",top:r.top+t.height()+5+"px",left:r.left+"px"});if(l){h.css({width:parseInt(i,10)-2+"px",top:r.top+t.height()+6+"px",left:r.left+1+"px",height:c.height()-2+"px"}).show()}c.show();if(n.autoSelectFirst||n.selectSingleMatch&&s.length==1)d(s.get(0))};var w=function(){if(u>=9&&u<=45){return}var r=t.val();if(r==a){return}a=r;if(r.length>=n.minChars){t.addClass(n.loadingClass);y(r,b)}else{if(r.length===0&&(n.onBlank?n.onBlank():true)){e(n.additionalFields).each(function(t,n){e(n).val("");e(this).change()})}t.removeClass(n.loadingClass);c.hide();h.hide()}};c.mousedown(function(e){if(e.srcElement)i=e.srcElement.tagName!="DIV"});e(document).mousedown(function(r){if(o&&c.is(":visible")&&c.has(r.target).length===0&&!t.is(e(r.target))&&t.val().toLowerCase()!=e(e("li",c).get(s)).text().toLowerCase()){s=-1;t.val("");e(n.additionalFields).each(function(t,n){e(n).val("");e(this).change()})}});t.keydown(function(r){u=r.keyCode;switch(r.keyCode){case 38:r.preventDefault();d(-1);break;case 40:r.preventDefault();if(!c.is(":visible")){b();d(0)}else{d(1)}break;case 13:if(m()){r.preventDefault();t.select()}break;case 9:break;case 27:if(s>-1&&n.exactMatch&&t.val()!=e(e("li",c).get(s)).text()){s=-1}e("li",c).removeClass(n.selectedClass);v();r.preventDefault();break;default:if(f){clearTimeout(f)}f=setTimeout(w,n.delay);break}}).focus(function(){o=true}).click(function(){o=true}).blur(function(e){if(s>-1){m()}o=false;if(f){clearTimeout(f)}f=setTimeout(function(){v();if(n.exactMatch&&t.val()!=t.lastSelected){r.selectItem(null,true)}},200)})};QuickSelect.matchers={all:function(e,t){return t},quicksilver:function(e,t){var n,r,i=this;n=i.options.matchCase?e:e.toLowerCase();i.AllItems[n]=[];for(var s=0;s<t.length;s++){r=i.options.matchCase?i.getLabel(t[s]):i.getLabel(t[s]).toLowerCase();if(r.score(n)>0||t[s][1]=="none"||t[s][1]=="newvalue:"+t[s][0]){i.AllItems[n].push(t[s])}}return i.AllItems[n].sort(function(e,t){e=i.options.matchCase?i.getLabel(e):i.getLabel(e).toLowerCase();t=i.options.matchCase?i.getLabel(t):i.getLabel(t).toLowerCase();e=e.score(n);t=t.score(n);return e>t?-1:t>e?1:0})},contains:function(e,t){var n,r,i=this;n=i.options.matchCase?e:e.toLowerCase();i.AllItems[n]=[];for(var s=0;s<t.length;s++){r=i.options.matchCase?i.getLabel(t[s]):i.getLabel(t[s]).toLowerCase();if(r.indexOf(n)>-1){i.AllItems[n].push(t[s])}}return i.AllItems[n].sort(function(e,t){e=i.options.matchCase?i.getLabel(e):i.getLabel(e).toLowerCase();t=i.options.matchCase?i.getLabel(t):i.getLabel(t).toLowerCase();var r=e.indexOf(n);var s=t.indexOf(n);return r>s?-1:r<s?1:e>t?-1:t>e?1:0})},startsWith:function(e,t){var n,r,i=this;n=i.options.matchCase?e:e.toLowerCase();i.AllItems[n]=[];for(var s=0;s<t.length;s++){r=i.options.matchCase?i.getLabel(t[s]):i.getLabel(t[s]).toLowerCase();if(r.indexOf(n)===0){i.AllItems[n].push(t[s])}}return i.AllItems[n].sort(function(e,t){e=i.options.matchCase?i.getLabel(e):i.getLabel(e).toLowerCase();t=i.options.matchCase?i.getLabel(t):i.getLabel(t).toLowerCase();return e>t?-1:t>e?1:0})}};QuickSelect.finders={data:function(e,t){t(this.options.data)},ajax:function(t,n){var r=this.options.ajax+"?q="+encodeURIComponent(t);for(var i in this.options.ajaxParams){if(this.options.ajaxParams.hasOwnProperty(i)){r+="&"+i+"="+encodeURIComponent(this.options.ajaxParams[i])}}e.getJSON(r,n)}};e.fn.quickselect=function(t,n){if(t=="instance"&&e(this).data("quickselect"))return e(this).data("quickselect");t=t||{};t.data=typeof t.data==="object"&&t.data.constructor==Array?t.data:undefined;t.ajaxParams=t.ajaxParams||{};t.delay=t.delay||400;if(!t.delay)t.delay=!t.ajax?400:10;t.minChars=t.minChars||1;t.cssFlavor=t.cssFlavor||"quickselect";t.inputClass=t.inputClass||t.cssFlavor+"_input";t.loadingClass=t.loadingClass||t.cssFlavor+"_loading";t.resultsClass=t.resultsClass||t.cssFlavor+"_results";t.selectedClass=t.selectedClass||t.cssFlavor+"_selected";t.finderFunction=t.finderFunction||QuickSelect.finders[!t.data?"ajax":"data"];if(t.finderFunction==="data"||t.finderFunction==="ajax")t.finderFunction=QuickSelect.finders[t.finderFunction];t.matchMethod=t.matchMethod||QuickSelect.matchers[typeof "".score==="function"&&"l".score("l")==1?"quicksilver":"contains"];if(t.matchMethod==="quicksilver"||t.matchMethod==="contains"||t.matchMethod==="startsWith")t.matchMethod=QuickSelect.matchers[t.matchMethod];t.matchMethod=QuickSelect.matchers["all"];if(t.matchCase===undefined)t.matchCase=false;if(t.exactMatch===undefined)t.exactMatch=false;if(t.autoSelectFirst===undefined)t.autoSelectFirst=true;if(t.selectSingleMatch===undefined)t.selectSingleMatch=true;if(t.additionalFields===undefined)t.additionalFields=e("nothing");t.maxVisibleItems=t.maxVisibleItems||-1;if(t.autoFill===undefined||t.matchMethod!="startsWith"){t.autoFill=false}t.width=parseInt(t.width,10)||0;return this.each(function(){var n=this,r=object(t);if(n.tagName=="INPUT"){var i=new QuickSelect(n,r);e(n).data("quickselect",i)}else if(n.tagName=="SELECT"){r.delay=r.delay||10;r.finderFunction="data";var s=n.name,o=n.id,u=n.className,a=e(n).attr("accesskey"),f=e(n).attr("tabindex"),l=e("option:selected",n).get(0);r.data=[];e("option",n).each(function(t,n){r.data.push({label:e(n).text(),values:[n.value,n.value],className:n.className})});var c=e("<input type='text' class='"+u+"' id='"+o+"_quickselect' accesskey='"+a+"' tabindex='"+f+"' />");if(l){c.val(e(l).text())}var h=e("<input type='hidden' id='"+o+"' name='"+n.name+"' />");if(l){h.val(l.value)}r.additionalFields=h;e(n).after(c).after(h).remove();c.quickselect(r)}})}})(jQuery)