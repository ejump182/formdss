name: e2e test suite

on: [push]

env:
  GITHUB_TOKEN: ${{ github.token }}

jobs:
  e2e-test-run:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - uses: actions/setup-node@v4
      with:
        node-version: 18
    - name: Set file/directory permissions
      run: |
        chmod 777 trust uploads modules templates_c cache mainfile.php
    - name: Run Docker Compose
      run: |
        docker-compose up -d
    - name: Wait for mysql
      uses: smurfpandey/wait-for-it@main
      with:
        host: localhost
        port: 3306
        timeout: 60
    - name: Connect to saucelabs
      uses: saucelabs/sauce-connect-action@v2
      with:
        username: ${{ secrets.SAUCE_USERNAME }}
        accessKey: ${{ secrets.SAUCE_ACCESS_KEY }}
        tunnelName: ${{ github.run_id }}
    - name: Saucectl RUN
      uses: saucelabs/saucectl-run-action@v4
      with:
        sauce-username: ${{ secrets.SAUCE_USERNAME }}
        sauce-access-key: ${{ secrets.SAUCE_ACCESS_KEY }}
        tunnel-name: ${{ github.run_id }}
    # - name: Install dependencies
    #   run: npm ci
    #   working-directory: ci
    # - name: Install Playwright Browsers
    #   run: npx playwright install --with-deps
    #   working-directory: ci
    # - name: Run Playwright tests
    #   run: npx playwright test
    #   working-directory: ci
    # - uses: actions/upload-artifact@v3
    #   if: always()
    #   with:
    #     name: playwright-report
    #     path: ci/playwright-report/
    #     retention-days: 30
    # - uses: actions/upload-artifact@v3
    #   if: always()
    #   with:
    #     name: test-results
    #     path: ci/test-results/
    #     retention-days: 30
    # - name: Setup tmate session
    #   uses: mxschmitt/action-tmate@v3
